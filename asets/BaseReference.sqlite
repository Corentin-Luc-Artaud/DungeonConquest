CREATE TABLE sqlite_sequence(name,seq);	

CREATE TABLE MATERIAUX (`NOM`	TEXT NOT NULL, `COEFICIENT` INTEGER NOT NULL DEFAULT 1, PRIMARY KEY(NOM));

	
CREATE TABLE "RARETE" (`TYPE_RARETE` TEXT NOT NULL DEFAULT 'COMUN',`COEFICIENT_RARETE` INTEGER NOT NULL DEFAULT 1 CHECK(COEFICIENT_RARETE < 10), PRIMARY KEY(TYPE_RARETE));	

	
CREATE TABLE TYPEARME (`TYPE`	TEXT NOT NULL, `BONUS_ARME` INTEGER NOT NULL DEFAULT 1 CHECK(BONUS_ARME < 10), PRIMARY KEY(TYPE));
	
CREATE TABLE "ACCESSOIRE" (`IDENTIFIANT_ACCESSOIRE` TEXT NOT NULL, `TYPE_ACCESSOIRE` TEXT NOT NULL DEFAULT 'BAGUE' CHECK(TYPE_ACCESSOIRE IN ( 'COLLIER' , 'BAGUE' )), `NIVEAU` INTEGER NOT NULL DEFAULT 1,`MATERIAUX_ACCESSOIRE` TEXT NOT NULL DEFAULT 'FER', `RARETE_ACCESSOIRE` TEXT NOT NULL DEFAULT 'COMMUN', PRIMARY KEY(IDENTIFIANT_ACCESSOIRE));
	
CREATE TABLE "ARME" (`IDENTIFIANT` TEXT NOT NULL DEFAULT 1,`NIVEAU` INTEGER NOT NULL DEFAULT 1,`MATERIAUX_ARME` TEXT NOT NULL DEFAULT 'FER',`RARETE_ARME` TEXT NOT NULL DEFAULT 'COMMUN',`TYPE` TEXT NOT NULL DEFAULT 'EPEE', PRIMARY KEY(IDENTIFIANT) );

CREATE TRIGGER CHECK_ARME_ON_INSERT BEFORE INSERT ON ARME FOR EACH ROW BEGIN SELECT RAISE(ABORT, 'MAUVAIS MATERIAUX') WHERE NEW.MATERIAUX_ARME NOT IN (SELECT NOM FROM MATERIAUX); SELECT RAISE(ABORT, 'MAUVAISE RARETE') WHERE NEW.RARETE_ARME NOT IN (SELECT TYPE_RARETE FROM RARETE); SELECT RAISE(ABORT, 'MAUVAIS TYPE') WHERE NEW.TYPE NOT IN (SELECT TYPE FROM TYPEARME); END;

CREATE TRIGGER CHECK_ARME_ON_UPDATE BEFORE UPDATE ON ARME FOR EACH ROW BEGIN SELECT RAISE(ABORT, 'MAUVAIS MATERIAUX') WHERE NEW.MATERIAUX_ARME NOT IN (SELECT NOM FROM MATERIAUX); SELECT RAISE(ABORT, 'MAUVAISE RARETE') WHERE NEW.RARETE_ARME NOT IN (SELECT TYPE_RARETE FROM RARETE); SELECT RAISE(ABORT, 'MAUVAIS TYPE') WHERE NEW.TYPE NOT IN (SELECT TYPE FROM TYPEARME); END;
	
CREATE TRIGGER CHECK_ACCESSOIRE_ON_INSERT BEFORE INSERT ON ACCESSOIRE FOR EACH ROW BEGIN SELECT RAISE(ABORT, 'MAUVAIS MATERIAUX') WHERE NEW.MATERIAUX_ACCESSOIRE NOT IN (SELECT NOM FROM MATERIAUX); SELECT RAISE(ABORT, 'MAUVAISE RARETE') WHERE NEW.RARETE_ACCESSOIRE NOT IN (SELECT TYPE_RARETE FROM RARETE); END;

CREATE TRIGGER CHECK_ACCESSOIRE_ON_UPDATE BEFORE UPDATE ON ACCESSOIRE FOR EACH ROW BEGIN SELECT RAISE(ABORT, 'MAUVAIS MATERIAUX') WHERE NEW.MATERIAUX_ACCESSOIRE NOT IN (SELECT NOM FROM MATERIAUX); SELECT RAISE(ABORT, 'MAUVAISE RARETE') WHERE NEW.RARETE_ACCESSOIRE NOT IN (SELECT TYPE_RARETE FROM RARETE); END;



INSERT INTO MATERIAUX VALUES ('FER', 1);
INSERT INTO MATERIAUX VALUES ('ACIER', 2);
INSERT INTO MATERIAUX VALUES ('ARGENT', 3);
INSERT INTO MATERIAUX VALUES ('OR', 4);
INSERT INTO MATERIAUX VALUES ('DIAMANT', 5);

INSERT INTO RARETE VALUES ('COMMUN', 1);
INSERT INTO RARETE VALUES ('RARE', 2);
INSERT INTO RARETE VALUES ('EPIQUE', 3);
INSERT INTO RARETE VALUES ('LEGENDAIRE', 4);
INSERT INTO RARETE VALUES ('DIVIN', 5);

INSERT INTO  TYPEARME VALUES ('EPEE', 1);
INSERT INTO  TYPEARME VALUES ('HACHE', 2);
INSERT INTO  TYPEARME VALUES ('MASSE', 3);


